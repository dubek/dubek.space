<!DOCTYPE html>
<html lang='en' dir='auto'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='It started when Daniel Stenberg, the curl project maintainer, announced the curl 8.9.0 release:
I was curious about CVE-2024-6197: it was a call to free(buf) where buf is a variable on the stack. Since this doesn&rsquo;t depend on specific content of buf, and should happen every time this code is reached, why wasn&rsquo;t it caught earlier during CI tests?
The answer is that it&rsquo;s a bit hard to get to that area of the code (parsing of certificate ASN.'>
<meta name='theme-color' content='#007a45'>

<meta property='og:title' content='The short story of curl CVE-2024-7264 • dubek.space'>
<meta property='og:description' content='It started when Daniel Stenberg, the curl project maintainer, announced the curl 8.9.0 release:
I was curious about CVE-2024-6197: it was a call to free(buf) where buf is a variable on the stack. Since this doesn&rsquo;t depend on specific content of buf, and should happen every time this code is reached, why wasn&rsquo;t it caught earlier during CI tests?
The answer is that it&rsquo;s a bit hard to get to that area of the code (parsing of certificate ASN.'>
<meta property='og:url' content='https://dubek.space/posts/2024-08-04-curl-cve-2024-7264/'>
<meta property='og:site_name' content='dubek.space'>
<meta property='og:type' content='article'><meta property='article:section' content='posts'><meta property='article:published_time' content='2024-08-04T08:00:00-04:00'/><meta property='article:modified_time' content='2024-08-04T08:00:00-04:00'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@dubek'>

<meta name="generator" content="Hugo 0.131.0">

  <title>The short story of curl CVE-2024-7264 • dubek.space</title>
  <link rel='canonical' href='https://dubek.space/posts/2024-08-04-curl-cve-2024-7264/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.ab98e12b.css'><link rel='stylesheet' href='/css/custom.css'><style>
:root{--color-accent:#007a45;}
</style>

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

</head>
<body class='page type-posts'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item current'>
        <a aria-current='page' href='/posts/'>Posts</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>dubek.space</p><p class='desc site-desc'></p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' dir='ltr' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>The short story of curl CVE-2024-7264</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
<line x1="16" y1="2" x2="16" y2="6" />
<line x1="8" y1="2" x2="8" y2="6" />
<line x1="3" y1="10" x2="21" y2="10" />
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2024-08-04T08:00:00-04:00'>2024, Aug 04</time>
</span>

  
  

</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>It started when Daniel Stenberg, the curl project maintainer, announced the curl 8.9.0 release:</p>


<iframe src="https://mastodon.social/@bagder/112840046078899910/embed" class="mastodon-embed" style="max-width: 100%; border: 0" width="400" allowfullscreen="allowfullscreen"></iframe>
<iframe src="https://mastodon.social/@bagder/112840052782602887/embed" class="mastodon-embed" style="max-width: 100%; border: 0" width="400" allowfullscreen="allowfullscreen"></iframe>
<script src="https://mastodon.social/embed.js" async="async"></script>


<p>I was curious about <a href="https://curl.se/docs/CVE-2024-7264.html">CVE-2024-6197</a>: it was a call to <code>free(buf)</code>
where <code>buf</code> is a variable on the stack.  Since this doesn&rsquo;t depend on specific content of buf, and should
happen every time this code is reached, why wasn&rsquo;t it caught earlier during CI tests?</p>
<p>The answer is that it&rsquo;s a bit hard to get to that area of the code (parsing of certificate ASN.1 format),
and that entire file is not used for most TLS engines that curl supports. Daniel
<a href="https://daniel.haxx.se/blog/2023/03/28/curl-code-coverage/">wrote last year</a> about the difficulty of
measuring coverage for curl, but the bottom line remains: the coverage of that particular source file is not
perfect.</p>
<p>My friend who used to work on hardware verification told me about a rule of thumb in the verification field:
if a bug is discovered in some module, it&rsquo;s a good heuristic to keep poking the same module.  I went and did
exactly that: I compiled curl with the gnutls backend (which means the certificate parsing code is included)
and with <a href="https://llvm.org/docs/LibFuzzer.html">LLVM libFuzzer</a> support.  I wrote a small fuzzing harness
for the internal <code>Curl_extract_certinfo()</code> function (which parses a certificate):</p>
<pre tabindex="0"><code>extern int LLVMFuzzerTestOneInput(const uint8_t *Data, size_t Size) {
  CURLcode result;
  struct Curl_easy *curldata;
  const char *beg = Data;
  const char *end = Data + Size;

  if (Size == 0) {
    return 0;
  }
  if(curl_global_init(CURL_GLOBAL_ALL) != CURLE_OK) {
    return 2; // ? not sure what we should do here ?
  }
  curldata = curl_easy_init();
  if (curldata) {
    result = Curl_extract_certinfo(curldata, 0, beg, end);
    curl_easy_cleanup(curldata);
  }
  curl_global_cleanup();
  return 0;  // Values other than 0 and -1 are reserved for future use.
}
</code></pre><p>As an initial fuzzing corpus I used one file which is available as part of
<a href="https://github.com/curl/curl/blob/master/tests/unit/unit1651.c#L41">curl&rsquo;s unit tests</a>.</p>
<p>After a few minutes of fuzzing&hellip; a crash! Heap memory overread. I reported it on July 29 at the end of my
day. By the time I woke up on July 30, Daniel and co-maintainer Stefan Icing already had a suggested fix.
A couple of iterations later the final fix was merged. Daniel wrote the vulnerability advisory, which ended
up as <a href="https://curl.se/docs/CVE-2024-7264.html">CVE-2024-7264</a> (low severity). Curl 8.9.1, which includes
this fix, was released on July 31st 2024, and the advisory was made public at the same time.</p>
<p>It was a fun quick find, and I had a super nice and professional interaction with the curl project
maintainers Daniel and Stefan.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'>
  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/posts/2023-01-08-kvm-forum-lpc-2022-confidential-computing/'>
        <span aria-hidden='true'><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><line x1="20" y1="12" x2="4" y2="12" />
<polyline points="10 18 4 12 10 6" />
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>KVM Forum 2022 and Linux Plumbers Conference 2022 talks on Confidential Computing</a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'>
    <ul><li>
        <a href='https://github.com/dubek' target='_blank' rel='noopener me'>
          <span class='screen-reader-text'>Open Github account in new tab</span><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/dubek' target='_blank' rel='noopener me'>
          <span class='screen-reader-text'>Open Twitter account in new tab</span><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" />
</svg>
</a>
      </li><li>
        <a href='https://mastodon.social/@dubek' target='_blank' rel='noopener me'>
          <span class='screen-reader-text'>Open Mastodon account in new tab</span><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><g transform="scale(1.5)">
  <path stroke="none" fill="currentColor" d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
</g>
</svg>
</a>
      </li></ul>
  </nav>
</section><div class='copyright'>
  <p> &copy; 2018-2024 Dov Murik </p>
</div>

        </div>
      </footer>

    </div>
  </div>

</body>

</html>

